<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PToken DApp</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
  <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <div class="mobile-container">
    <!-- هدر -->
    <header class="mobile-header">
      <div class="header-content">
        <div class="logo">
          <div class="logo-icon">
            <i class="fas fa-coins"></i>
          </div>
          <div class="logo-text">
            <h1>PToken</h1>
            <span class="logo-subtitle">Polygon Network</span>
          </div>
        </div>
        <div class="network-status">
          <div class="status-indicator">
            <div class="pulse-dot"></div>
            <span>آنلاین</span>
          </div>
        </div>
      </div>
    </header>

    <!-- محتوای اصلی -->
    <main class="mobile-main">
      <!-- تب کیف پول -->
      <div id="wallet-tab" class="tab-content active">
        <div class="mobile-section">
          <div class="hero-section">
            <div class="hero-icon">
              <div class="floating-wallet">
                <i class="fas fa-wallet"></i>
              </div>
              <div class="floating-coin coin-1">
                <i class="fas fa-circle"></i>
              </div>
              <div class="floating-coin coin-2">
                <i class="fas fa-circle"></i>
              </div>
              <div class="floating-coin coin-3">
                <i class="fas fa-circle"></i>
              </div>
            </div>
            <h2 class="hero-title">خوش آمدید</h2>
            <p class="hero-subtitle">برای شروع، کیف پول خود را متصل کنید</p>
          </div>

          <div class="action-card">
            <button id="connect-btn" onclick="connectWallet()" class="btn-connect animated-btn">
              <div class="btn-content">
                <i class="fas fa-plug"></i>
                <span>اتصال به MetaMask</span>
              </div>
              <div class="btn-glow"></div>
            </button>

            <button id="disconnect-btn" onclick="disconnectWallet()" class="btn-disconnect" style="display: none;">
              <i class="fas fa-power-off"></i>
              قطع اتصال
            </button>
          </div>

          <div id="account" class="account-display" style="display: none;">
            <div class="account-card">
              <div class="account-header">
                <i class="fas fa-check-circle"></i>
                <span>اتصال موفق</span>
              </div>
              <div class="account-address"></div>
              <div class="account-balance">
                <span class="balance-label">موجودی:</span>
                <span class="balance-value" id="wallet-balance">0 MATIC</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- تب اطلاعات کاربر -->
      <div id="user-tab" class="tab-content">
        <div class="mobile-section">
          <div class="profile-header">
            <div class="profile-banner">
              <div class="banner-content">
                <div class="user-avatar">
                  <i class="fas fa-user-circle"></i>
                </div>
                <div class="user-info">
                  <h2>پروفایل کاربری</h2>
                  <div class="user-status" id="user-status">
                    <span class="status-badge registered" id="status-badge">
                      <i class="fas fa-check-circle"></i>
                      ثبت‌نام شده
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- بخش ثبت‌نام برای کاربران جدید -->
          <div id="registration-section" class="registration-section" style="display: none;">
            <div class="section-title">
              <h3>ثبت‌نام در سیستم</h3>
              <div class="price-tag">350 MATIC</div>
            </div>
            
            <div class="registration-card">
              <div class="card-background">
                <div class="background-pattern"></div>
              </div>
              
              <div class="form-group">
                <label class="input-label">
                  <i class="fas fa-user-friends"></i>
                  شناسه کاربر آپلاین
                </label>
                <input id="upline-address" type="number" placeholder="مثال: 1234" class="modern-input">
              </div>

              <div class="position-selector">
                <div class="selector-title">موقعیت قرارگیری</div>
                <div class="position-options">
                  <label class="position-card">
                    <input type="radio" name="place" value="left" checked>
                    <div class="card-content">
                      <div class="position-icon left">
                        <i class="fas fa-arrow-left"></i>
                      </div>
                      <span>سمت چپ</span>
                    </div>
                  </label>
                  <label class="position-card">
                    <input type="radio" name="place" value="right">
                    <div class="card-content">
                      <div class="position-icon right">
                        <i class="fas fa-arrow-right"></i>
                      </div>
                      <span>سمت راست</span>
                    </div>
                  </label>
                </div>
              </div>

              <button onclick="register()" class="btn-register animated-btn">
                <i class="fas fa-user-plus"></i>
                تکمیل ثبت‌نام
              </button>
            </div>
          </div>

          <!-- اطلاعات کاربر ثبت‌نام شده -->
          <div id="user-info-section" class="user-info-section" style="display: none;">
            <div class="user-stats-container">
              <div class="stats-grid">
                <div class="stat-item fade-in">
                  <div class="stat-header">
                    <div class="stat-icon">
                      <i class="fas fa-id-card"></i>
                    </div>
                    <span class="stat-label">شناسه شما</span>
                  </div>
                  <div class="stat-value" id="user-id">-</div>
                </div>

                <div class="stat-item fade-in">
                  <div class="stat-header">
                    <div class="stat-icon">
                      <i class="fas fa-user-tag"></i>
                    </div>
                    <span class="stat-label">آپلاین</span>
                  </div>
                  <div class="stat-value" id="user-upline">-</div>
                </div>

                <div class="stat-item fade-in">
                  <div class="stat-header">
                    <div class="stat-icon">
                      <i class="fas fa-users"></i>
                    </div>
                    <span class="stat-label">زیرمجموعه</span>
                  </div>
                  <div class="stat-value" id="total-referrals">0</div>
                </div>

                <div class="stat-item fade-in">
                  <div class="stat-header">
                    <div class="stat-icon">
                      <i class="fas fa-chart-line"></i>
                    </div>
                    <span class="stat-label">تعادل خورده</span>
                  </div>
                  <div class="stat-value" id="balance-count">0</div>
                </div>
              </div>
              
              <div class="balance-details">
                <div class="balance-card">
                  <div class="balance-header">
                    <i class="fas fa-save"></i>
                    <h4>سیوهای شما</h4>
                  </div>
                  <div class="balance-stats">
                    <div class="balance-stat">
                      <span class="balance-label">سیو چپ:</span>
                      <span class="balance-value" id="save-left">0</span>
                    </div>
                    <div class="balance-stat">
                      <span class="balance-label">سیو راست:</span>
                      <span class="balance-value" id="save-right">0</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- تب شجره‌نامه -->
      <div id="tree-tab" class="tab-content">
        <div class="mobile-section">
          <div class="section-header">
            <h2>شجره‌نامه</h2>
            <button onclick="displayTree()" class="btn-refresh">
              <i class="fas fa-sync-alt"></i>
            </button>
          </div>

          <div class="tree-wrapper">
            <div class="tree-info">
              <div class="tree-stats">
                <div class="tree-stat">
                  <span>کل اعضا:</span>
                  <strong id="total-members">0</strong>
                </div>
                <div class="tree-stat">
                  <span>سطح فعلی:</span>
                  <strong id="current-level">1</strong>
                </div>
              </div>
            </div>

            <div class="tree-container">
              <div id="tree" class="genealogy-tree">
                <div class="tree-placeholder">
                  <div class="placeholder-icon">
                    <i class="fas fa-sitemap"></i>
                  </div>
                  <p>شبکه شما خالی است</p>
                  <span>پس از ثبت‌نام، شجره‌نامه شما اینجا نمایش داده می‌شود</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- تب ماینر -->
      <div id="miner-tab" class="tab-content">
        <div class="mobile-section">
          <div class="miner-header">
            <h2>سیستم ماینر</h2>
            <div class="miner-status" id="miner-global-status">
              <div class="status-indicator"></div>
              <span id="global-miner-status">غیرفعال</span>
            </div>
          </div>

          <div class="miner-dashboard">
            <div class="miner-visual">
              <div class="miner-animation" id="miner-animation">
                <div class="miner-icon sleeping">
                  <i class="fas fa-bed"></i>
                </div>
                <div class="miner-status-text">ماینر در حال استراحت</div>
              </div>
            </div>

            <div class="miner-card primary">
              <div class="miner-card-content">
                <div class="miner-icon">
                  <i class="fas fa-hard-hat"></i>
                </div>
                <div class="miner-info">
                  <div class="miner-label">وضعیت ماینر</div>
                  <div class="miner-value" id="miner-status">غیرفعال</div>
                </div>
              </div>
            </div>

            <div class="miner-stats">
              <div class="miner-stat-card">
                <div class="stat-icon">
                  <i class="fas fa-coins"></i>
                </div>
                <div class="stat-content">
                  <div class="stat-label">توکن دریافتی</div>
                  <div class="stat-value" id="miner-rewards">0 PToken</div>
                </div>
              </div>

              <div class="miner-stat-card">
                <div class="stat-icon">
                  <i class="fas fa-gem"></i>
                </div>
                <div class="stat-content">
                  <div class="stat-label">توکن قابل خرید</div>
                  <div class="stat-value" id="available-tokens">0 PToken</div>
                </div>
              </div>

              <div class="miner-stat-card">
                <div class="stat-icon">
                  <i class="fas fa-money-bill-wave"></i>
                </div>
                <div class="stat-content">
                  <div class="stat-label">پالیگان مورد نیاز</div>
                  <div class="stat-value" id="polygon-needed">0.1 MATIC</div>
                </div>
              </div>
            </div>

            <div class="miner-actions">
              <button onclick="contributeToMiner()" class="btn-miner-action primary">
                <i class="fas fa-donate"></i>
                خرید توکن ماینر
              </button>
              <button onclick="distributeMinerTokens()" class="btn-miner-action secondary">
                <i class="fas fa-share-alt"></i>
                دریافت پاداش
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- تب برداشت -->
      <div id="withdraw-tab" class="tab-content">
        <div class="mobile-section">
          <div class="section-header">
            <h2>دریافت سود</h2>
            <div class="earnings-badge">
              <i class="fas fa-money-bill-wave"></i>
            </div>
          </div>

          <div class="withdraw-cards">
            <div class="withdraw-card">
              <div class="card-header">
                <div class="card-icon">
                  <i class="fas fa-wallet"></i>
                </div>
                <h3>برداشت از استخر</h3>
              </div>
              <div class="card-content">
                <div class="amount-display">
                  <span class="amount" id="pool-balance">0</span>
                  <span class="currency">MATIC</span>
                </div>
                <div class="pool-info">
                  <div class="info-item">
                    <span>تعداد برندگان:</span>
                    <span id="pool-winners">0 نفر</span>
                  </div>
                  <div class="info-item">
                    <span>زمان برداشت:</span>
                    <span id="pool-time">-</span>
                  </div>
                </div>
                <button onclick="withdrawPool()" class="btn-withdraw">
                  <i class="fas fa-download"></i>
                  دریافت
                </button>
              </div>
            </div>

            <div class="withdraw-card">
              <div class="card-header">
                <div class="card-icon">
                  <i class="fas fa-gem"></i>
                </div>
                <h3>برداشت ویژه</h3>
              </div>
              <div class="card-content">
                <div class="amount-display">
                  <span class="amount" id="special-balance">0</span>
                  <span class="currency">MATIC</span>
                </div>
                <div class="pool-info">
                  <div class="info-item">
                    <span>تعداد برندگان:</span>
                    <span id="special-winners">0 نفر</span>
                  </div>
                  <div class="info-item">
                    <span>زمان برداشت:</span>
                    <span id="special-time">-</span>
                  </div>
                </div>
                <button onclick="withdrawSpecials()" class="btn-withdraw">
                  <i class="fas fa-download"></i>
                  دریافت
                </button>
              </div>
            </div>
          </div>

          <div class="earnings-stats">
            <div class="earnings-stat">
              <div class="stat-label">کل برداشت‌ها</div>
              <div class="stat-value" id="total-withdrawals">0 MATIC</div>
            </div>
            <div class="earnings-stat">
              <div class="stat-label">آخرین برداشت</div>
              <div class="stat-value" id="last-withdrawal">-</div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- ناوبری پایین -->
    <nav class="bottom-nav">
      <div class="nav-item active" onclick="switchTab('wallet')">
        <div class="nav-icon">
          <i class="fas fa-wallet"></i>
        </div>
        <span class="nav-label">کیف پول</span>
      </div>
      <div class="nav-item" onclick="switchTab('user')">
        <div class="nav-icon">
          <i class="fas fa-user"></i>
        </div>
        <span class="nav-label">پروفایل</span>
      </div>
      <div class="nav-item" onclick="switchTab('tree')">
        <div class="nav-icon">
          <i class="fas fa-sitemap"></i>
        </div>
        <span class="nav-label">شجره‌نامه</span>
      </div>
      <div class="nav-item" onclick="switchTab('miner')">
        <div class="nav-icon">
          <i class="fas fa-hard-hat"></i>
        </div>
        <span class="nav-label">ماینر</span>
      </div>
      <div class="nav-item" onclick="switchTab('withdraw')">
        <div class="nav-icon">
          <i class="fas fa-money-bill-wave"></i>
        </div>
        <span class="nav-label">برداشت</span>
      </div>
    </nav>
  </div>

  <div id="message" class="message-toast"></div>

  <script src="app.js"></script>
</body>
</html>